# 商城小程序项目技术架构设计文档

## 一、项目概述

本项目是一个微信商城小程序系统，由三个子项目组成：
1. **商城小程序前端**：面向用户的微信小程序应用
2. **商城管理后台**：面向管理员的Web管理系统
3. **后端API服务**：为小程序前端和管理后台提供数据服务

## 二、总体架构设计

### 系统架构图

```
+--------------------+     +--------------------+
|                    |     |                    |
|   微信小程序前端    |     |   管理后台(PC端)   |
|  (微信小程序原生)   |     |   (Vue3 + TS)     |
|                    |     |                    |
+--------+-----------+     +-----------+--------+
         |                             |
         |     HTTP请求（RESTful API）  |
         |                             |
+--------v-----------------------------v--------+
|                                               |
|               后端API服务                     |
|          (Node.js + Express)                 |
|                                               |
+---------------------+-------------------------+
                      |
                      |
          +-----------v-----------+
          |                       |
          |      MySQL数据库      |
          |                       |
          +-----------------------+
```

### 技术栈选择

1. **小程序前端**
   - 开发框架：微信小程序原生框架
   - UI组件：微信小程序vant组件库、原生组件
   - 状态管理：小程序全局状态管理

2. **管理后台**
   - 前端框架：Vue 3 + TypeScript
   - UI组件库：Element Plus
   - 路由管理：Vue Router
   - 状态管理：Pinia
   - HTTP客户端：Axios
   - 构建工具：Vite

3. **后端API服务**
   - 运行环境：Node.js
   - Web框架：Express
   - 数据库：MySQL
   - 身份认证：JWT (JSON Web Token)
   - api文档：Swagger

## 三、前端架构设计

### 1. 微信小程序架构

**特点**：
- 采用微信小程序原生开发，无需额外打包构建流程
- 页面分包加载，提高首次启动速度
- 组件化开发，提高代码复用率

**主要功能模块**：
- 用户模块：登录、注册、个人信息管理
- 商品模块：商品浏览、搜索、分类、详情
- 购物车模块：商品添加、数量调整、结算
- 订单模块：订单创建、支付、查询、评价
- 地址管理模块：收货地址的增删改查

### 2. 管理后台架构

**特点**：
- 基于Vue 3的组件化、响应式开发
- 采用TypeScript提高代码质量和开发效率
- 使用Element Plus组件库，快速构建标准化后台界面

**主要功能模块**：
- 登录认证模块：管理员登录、权限控制
- 商品管理模块：商品CRUD、分类管理
- 订单管理模块：订单查询、状态管理、发货处理
- 用户管理模块：用户信息查看、状态管理
- 数据统计模块：销售数据、用户增长等可视化统计

## 四、后端架构设计

### 1. API服务架构

**特点**：
- RESTful API设计，统一接口规范
- 中间件分层处理请求，提高代码可维护性
- 统一响应格式，便于前端处理结果

**主要功能模块**：
- 身份认证模块：用户登录、token生成与验证
- 用户模块：用户信息管理
- 商品模块：商品信息管理
- 订单模块：订单处理、支付集成
- 统计模块：数据聚合与统计

### 2. 数据库设计

**主要数据表**：
- 用户表(users)：存储用户基本信息
- 商品表(goods)：存储商品信息
- 商品分类表(categories)：存储商品分类
- 订单表(orders)：存储订单基本信息
- 订单商品表(order_goods)：存储订单商品详情
- 收货地址表(addresses)：存储用户收货地址
- 购物车表(carts)：存储用户购物车信息
- 轮播图表(banners)：存储首页轮播图信息

## 五、安全设计

为保障系统安全，项目采取以下安全措施：

### 1. 前端安全

1. **数据加密**
   - 敏感数据传输采用HTTPS协议
   - 重要请求参数进行签名验证

2. **输入验证**
   - 前端表单数据进行合法性验证
   - 防止XSS攻击，过滤特殊字符

3. **权限控制**
   - 基于角色的访问控制
   - 页面级别的权限验证

### 2. 后端安全

1. **身份认证**
   - 采用JWT进行身份验证
   - Token定期失效策略

2. **数据安全**
   - 密码加密存储（bcrypt）
   - 防止SQL注入攻击

3. **接口安全**
   - 接口访问频率限制(Rate Limiting)
   - 关键操作需二次验证

4. **服务器安全**
   - 定期安全更新
   - 错误日志监控

## 六、部署架构

### 1. 环境配置

1. **开发环境**
   - 配置文件：`config.development.js`
   - 环境变量：`NODE_ENV=development` 
   - 特点：
     - 开启调试模式
     - 详细的日志记录
     - 模拟数据支持
     - 热更新功能

2. **生产环境**
   - 配置文件：`config.production.js`
   - 环境变量：`NODE_ENV=production`
   - 特点：
     - 性能优化配置
     - 最小化日志记录
     - 错误监控与报警
     - 高可用性设置

3. **配置文件加载机制**
   - 通过环境变量`NODE_ENV`自动选择对应配置文件
   - 配置文件加载流程:
     ```js
     // config/index.js
     const env = process.env.NODE_ENV || 'development'
     const config = require(`./config.${env}.js`)
     module.exports = config
     ```
   - 启动命令示例:
     ```bash
     # 开发环境
     NODE_ENV=development npm run start
     
     # 生产环境
     NODE_ENV=production npm run start
     ```
   - 支持配置合并与覆盖:
     - 基础配置(`config.base.js`)
     - 环境特定配置覆盖基础配置

### 2. 部署流程

```
+-------------------+           +-------------------+
|                   |           |                   |
|   微信开发者工具   |           |    开发者电脑     |
|  (小程序开发环境)  |           | (Vue3开发环境)    |
|                   |           |                   |
+-------------------+           +-------------------+
          |                              |
          | 开发部署                      | 打包构建
          |                              |
+-------------------+           +-------------------+
|                   |           |                   |
|   微信小程序平台   |           |   Web服务器       |
| (小程序运行环境)   |           | (Nginx/静态资源)  |
|                   |           |                   |
+-------------------+           +-------------------+
                                        |
               +------------------------+
               |
    +----------v-----------+
    |                      |
    |    应用服务器        |
    | (Node.js + Express)  |
    |                      |
    +----------+-----------+
               |
    +----------v-----------+
    |                      |
    |     数据库服务器      |
    |      (MySQL)         |
    |                      |
    +----------------------+
```

## 七、项目目录结构

项目目录结构详见以下文件：
- `项目目录结构-微信小程序前端.md`
- `项目目录结构-管理后台.md`
- `项目目录结构-后端API服务.md`

## 八、接口规范

### 1. 请求格式

- API采用RESTful风格设计
- 请求方法：
  - GET：查询数据
  - POST：创建数据
  - PUT：更新数据
  - DELETE：删除数据
- 请求头包含：
  - Content-Type: application/json
  - Authorization: Bearer {token} (需要认证的接口)

### 2. 响应格式

统一的JSON响应格式：

```json
{
  "code": 200,      // 状态码：200成功，非200失败
  "message": "操作成功", // 提示信息
  "data": {}        // 响应数据，可能是对象或数组
}
```

### 3. 状态码说明

- 200: 成功
- 400: 请求参数错误
- 401: 未授权（未登录或token失效）
- 403: 权限不足
- 404: 资源不存在
- 500: 服务器内部错误

## 九、开发流程

1. **需求分析**：明确功能需求和界面原型
2. **架构设计**：确定技术栈和系统架构
3. **数据库设计**：设计数据表结构
4. **API设计**：设计前后端交互接口
5. **前端开发**：小程序和管理后台界面开发
6. **后端开发**：API服务实现
7. **集成测试**：系统集成和功能测试
8. **部署上线**：系统部署和监控

## 十、扩展考虑

虽然当前不考虑高并发问题，但系统设计预留以下扩展空间：

1. **水平扩展**：API服务可以部署多实例，通过负载均衡分发请求
2. **缓存引入**：可引入Redis缓存热点数据，减轻数据库压力
3. **服务拆分**：可按业务模块拆分为微服务，独立扩展
4. **数据库优化**：可引入读写分离、分库分表等策略

# 环境配置与部署

## 环境配置结构

本项目采用多环境配置方案，以支持不同部署环境下的系统运行。各系统组件（小程序、管理后台、API服务）采用统一的配置结构：

```
config/
├── index.js          # 配置入口，负责根据环境加载对应配置
├── default.js        # 默认配置，包含所有环境通用配置项
├── development.js    # 开发环境特定配置
└── production.js     # 生产环境特定配置
```

## 环境区分机制

系统通过以下方式识别运行环境：

### 环境变量方式
```
NODE_ENV=development  # 开发环境
NODE_ENV=production   # 生产环境
```

### 启动参数方式
```
--env=development     # 开发环境
--env=production      # 生产环境
```

## 配置加载流程

1. 程序启动时检测环境变量或启动参数
2. 加载默认配置（default.js）
3. 根据环境加载对应的环境配置文件，覆盖默认值
4. 从环境变量中加载敏感配置（如数据库密码、API密钥）
5. 配置合并完成，供程序使用

## 主要环境特点对比

| 配置类别 | 开发环境 | 生产环境 |
|---------|---------|---------|
| 服务器地址 | 本地主机/测试服务器 | 正式生产服务器 |
| 数据库连接 | 本地/开发数据库 | 生产数据库集群 |
| 日志级别 | DEBUG/INFO（详细） | WARNING/ERROR（精简） |
| 调试功能 | 开启 | 关闭 |
| 性能优化 | 关闭（便于调试） | 开启（压缩、缓存等） |
| 安全设置 | 基本配置 | 完整安全策略 |

## 部署方案

### 小程序部署
- 开发环境：微信开发者工具预览和调试
- 生产环境：提交微信平台审核并发布

### 管理后台部署
- 开发环境：本地开发服务器运行
- 生产环境：打包后部署到Nginx服务器

### API服务部署
- 开发环境：本地Node.js服务运行
- 生产环境：使用PM2管理Node.js进程 